<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>starsmashertools.lib.simulation &mdash; starsmashertools 14.12.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=61ccec80"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            starsmashertools
          </a>
              <div class="version">
                14.12.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cliprograms.html">CLI Programs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.helpers.file.html">starsmashertools.helpers.file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.archive.html">starsmashertools.lib.archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.binary.html">starsmashertools.lib.binary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.dynamical.html">starsmashertools.lib.dynamical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.energyfile.html">starsmashertools.lib.energyfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.flux.html">starsmashertools.lib.flux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.input.html">starsmashertools.lib.input</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.logfile.html">starsmashertools.lib.logfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.output.html">starsmashertools.lib.output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.ray.html">starsmashertools.lib.ray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.relaxation.html">starsmashertools.lib.relaxation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.report.html">starsmashertools.lib.report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.simulation.html">starsmashertools.lib.simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.lib.units.html">starsmashertools.lib.units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.math.html">starsmashertools.math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.mpl.artists.html">starsmashertools.mpl.artists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/starsmashertools.mpl.figure.html">starsmashertools.mpl.figure</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">starsmashertools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">starsmashertools.lib.simulation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for starsmashertools.lib.simulation</h1><div class="highlight"><pre>
<span></span><span class="c1"># These need to be imported at the top because they are used in parts of</span>
<span class="c1"># parameter annotations. Everything else should be loaded dynamically to avoid</span>
<span class="c1"># errors.</span>
<span class="kn">import</span> <span class="nn">starsmashertools.preferences</span>
<span class="kn">from</span> <span class="nn">starsmashertools.preferences</span> <span class="kn">import</span> <span class="n">Pref</span>
<span class="kn">import</span> <span class="nn">starsmashertools.lib.units</span>
<span class="kn">import</span> <span class="nn">starsmashertools.helpers.argumentenforcer</span>
<span class="kn">from</span> <span class="nn">starsmashertools.helpers.apidecorator</span> <span class="kn">import</span> <span class="n">api</span>
<span class="kn">from</span> <span class="nn">starsmashertools.helpers.clidecorator</span> <span class="kn">import</span> <span class="n">cli</span><span class="p">,</span> <span class="n">clioptions</span>
<span class="kn">from</span> <span class="nn">starsmashertools.helpers.archiveddecorator</span> <span class="kn">import</span> <span class="n">archived</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">filecmp</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">has_matplotlib</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">has_matplotlib</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Simulation">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation">[docs]</a>
<span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">use</span>
<span class="k">class</span> <span class="nc">Simulation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1">############################################################################</span>
    <span class="c1"># private attributes</span>

<div class="viewcode-block" id="Simulation.__init__">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.__init__">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span> <span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.input</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.output</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.archive</span>
        
        <span class="c1"># Prepare the directory string</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">directory</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        
        <span class="c1"># Validate the directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">valid_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">InvalidDirectoryError</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_teos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logfiles</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_task</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joined_simulations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_retrieved_joined_simulations</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">archive</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">SimulationArchive</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">on_nosave_disabled</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_joined_simulations</span><span class="p">]</span></div>

            
    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__json_view__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># For pickling</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,))</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">joined_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_joined_simulations</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_joined_simulations</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_retrieved_joined_simulations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">mtime</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_retrieved_joined_simulations</span><span class="p">)</span> <span class="ow">or</span>
                <span class="c1"># If the archive is in &quot;nosave&quot; mode, check if its buffers have</span>
                <span class="c1"># any content. If so, updated the joined simulations</span>
                <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">auto_save</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">is_nosave</span><span class="p">)</span> <span class="ow">and</span>
                 <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">_buffers</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_joined_simulations</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_joined_simulations</span>

    <span class="k">def</span> <span class="nf">_update_joined_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="kn">import</span> <span class="nn">starsmashertools</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.warnings</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_joined_simulations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="s1">&#39;joined simulations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_joined_simulations</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="n">starsmashertools</span><span class="o">.</span><span class="n">get_simulation</span><span class="p">(</span>
                            <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                                <span class="n">directory</span><span class="p">,</span>
                                <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                <span class="k">except</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">InvalidDirectoryError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_joined_simulations</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="n">starsmashertools</span><span class="o">.</span><span class="n">get_simulation</span><span class="p">(</span>
                                <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                                    <span class="n">directory</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">]</span>
                    <span class="k">except</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">InvalidDirectoryError</span><span class="p">:</span>
                        <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;A joined simulation is no longer a valid directory, likely because it was moved on the file system. Please split the simulation and re-join it to quell this warning. &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_retrieved_joined_simulations</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_retrieved_joined_simulations</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    
<div class="viewcode-block" id="Simulation.__eq__">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.__eq__">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># Check if the basenames are the same, so that e.g. pdc.json</span>
        <span class="c1"># files can work on different file systems</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Simulation</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">samefile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span></div>


<div class="viewcode-block" id="Simulation.__getitem__">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.__getitem__">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="Simulation.__contains__">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.__contains__">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.output</span>

        <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span><span class="p">({</span>
            <span class="s1">&#39;item&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Output</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">OutputIterator</span><span class="p">],</span>
        <span class="p">})</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Output</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_generator</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="n">item</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">item</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="n">realpath</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_generator</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="n">realpath</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
            
        <span class="n">iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_iterator</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">filenames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="c1"># Override this in children. Must return a list of Simulation objects</span>
    <span class="k">def</span> <span class="nf">_get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="nf">_get_compression_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">dirname</span><span class="o">+</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_get_sphinit_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Obtain the &#39;sph.init&#39; file this simulation uses by checking the</span>
        <span class="c1"># StarSmasher source code for the filename that gets read.</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.file</span>
        
        <span class="n">src</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">get_src</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">initfile</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s1">&#39;init.f&#39;</span><span class="p">)</span>
        <span class="n">last_open_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">initfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lock</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ls</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;open(&#39;</span><span class="p">):</span> <span class="n">last_open_line</span> <span class="o">=</span> <span class="n">line</span>
                <span class="k">if</span> <span class="n">ls</span> <span class="o">==</span> <span class="s1">&#39;read(12,initt)&#39;</span><span class="p">:</span> <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to find the init file name because a line with content &#39;read(12,initt)&#39; was not found in &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">initfile</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">last_open_line</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to find a line where the init file gets opened in &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">initfile</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">last_open_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Something went wrong while parsing the Fortran code to find the init file name in &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">initfile</span><span class="p">)</span>








        
    <span class="c1">############################################################################</span>
    <span class="c1"># public attributes</span>

    <span class="c1">###</span>
    <span class="c1"># Exceptions</span>
    <span class="c1">###</span>

    <span class="k">class</span> <span class="nc">InvalidDirectoryError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>
    
    <span class="k">class</span> <span class="nc">OutputNotInSimulationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Output is not a member of simulation: &#39;</span><span class="si">%s</span><span class="s2">&#39; for simulation &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">simulation</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">OutputNotInSimulationError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">JoinError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation1</span><span class="p">,</span> <span class="n">simulation2</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start_file</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start file&#39;</span><span class="p">)</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Cannot join simulation &#39;</span><span class="si">{sim1:s}</span><span class="s2">&#39; and &#39;</span><span class="si">{sim2:s}</span><span class="s2">&#39; because neither simulations were started from one another. That is, &#39;</span><span class="si">{start_file:s}</span><span class="s2">&#39; in one or both of these simulations does not originate from an output file in one of these simulations.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">sim1</span> <span class="o">=</span> <span class="n">simulation1</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                    <span class="n">sim2</span> <span class="o">=</span> <span class="n">simulation2</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                    <span class="n">start_file</span> <span class="o">=</span> <span class="n">start_file</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">JoinError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    
    <span class="c1">###</span>
    <span class="c1"># Object functionality</span>
    <span class="c1">###</span>
    
<div class="viewcode-block" id="Simulation.keys">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.keys">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simulation.values">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.values">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simulation.items">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.items">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isRelaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.relaxation</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">Relaxation</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isBinary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.binary</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">binary</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isDynamical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.dynamical</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">dynamical</span><span class="o">.</span><span class="n">Dynamical</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">teos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_teos</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;neos&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
            <span class="kn">import</span> <span class="nn">starsmashertools.lib.table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_teos</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">TEOS</span><span class="p">(</span>
                <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span>
                    <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;eosfile&#39;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_teos</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">compressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.compressiontask</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_compression_filename</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">compressiontask</span><span class="o">.</span><span class="n">CompressionTask</span><span class="o">.</span><span class="n">isCompressedFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
<div class="viewcode-block" id="Simulation.get_search_directory">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_search_directory">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_search_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the default search directory from the preferences.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The :meth:`os.path.realpath` of the default search directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="n">search_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;search directory&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">search_directory</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Simulation.get_compressed_properties">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_compressed_properties">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_compressed_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a dictionary of properties on the files contained in the compressed</span>
<span class="sd">        archive.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary whose keys are the names of the files in the compressed</span>
<span class="sd">            archive that they would have if the archive were decompressed. Each</span>
<span class="sd">            value is a dictionary holding various values corresponding to each</span>
<span class="sd">            file in the archive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.compressiontask</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressed</span><span class="p">:</span> <span class="k">return</span> <span class="p">{}</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_compression_filename</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">compressiontask</span><span class="o">.</span><span class="n">CompressionTask</span><span class="o">.</span><span class="n">get_compressed_properties</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


    
    
    <span class="c1">###</span>
    <span class="c1"># Files and directories</span>
    <span class="c1">###</span>

<div class="viewcode-block" id="Simulation.valid_directory">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.valid_directory">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">valid_directory</span><span class="p">(</span><span class="n">directory</span> <span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">get_src</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">InvalidDirectoryError</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span></div>

    
<div class="viewcode-block" id="Simulation.get_logfiles">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_logfiles">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_logfiles</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of :class:`~.logfile.LogFile`\, sorted by oldest-to-newest,</span>
<span class="sd">        including those in subdirectories in the simulation directory.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Passed directly to :meth:`~.logfile.find`\.</span>

<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True`\, the joined simulations will be included in the search.</span>
<span class="sd">            Otherwise, only this simulation will be searched.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of :class:`~.logfile.LogFile` sorted from oldest-to-newest by</span>
<span class="sd">            system modification times.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.logfile</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logfiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logfiles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_path</span> <span class="ow">in</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">logfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logfiles</span> <span class="o">+=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">logfile</span><span class="o">.</span><span class="n">LogFile</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="bp">self</span><span class="p">)]</span>

        <span class="n">all_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">logfile</span> <span class="k">for</span> <span class="n">logfile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logfiles</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">include_joined</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">simulation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joined_simulations</span><span class="p">:</span>
                <span class="n">all_files</span> <span class="o">+=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_logfiles</span><span class="p">(</span>
                    <span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">all_files</span><span class="p">:</span> <span class="c1"># Sort the log files by modification times</span>
            <span class="n">modtimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">modtimes</span><span class="p">,</span> <span class="n">all_files</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        
        <span class="k">return</span> <span class="n">all_files</span></div>


<div class="viewcode-block" id="Simulation.set_children">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.set_children">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="nd">@cli</span><span class="p">(</span><span class="s1">&#39;starsmashertools&#39;</span><span class="p">)</span>
    <span class="nd">@clioptions</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Set children&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_children</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">children</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">,</span>
            <span class="n">cli</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the list of :class:`~.Simulation` objects that were used to create</span>
<span class="sd">        this simulation. This can save time on searching the file system for </span>
<span class="sd">        child simulations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        children : list, tuple, str</span>
<span class="sd">            If a `list` or `tuple` is given, this simulation&#39;s children become</span>
<span class="sd">            the contents of ``children``\. Thus, each element must at least be of</span>
<span class="sd">            type :class:`~.Simulation`\. If a `str` or :class:`~.Simulation` is </span>
<span class="sd">            given, then :meth:`starsmashertools.get_simulation` will be called</span>
<span class="sd">            if it is a `str`\, and then this simulation will have one child.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`~.get_children`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">get_simulation</span><span class="p">(</span><span class="n">children</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span> <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">children</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span> <span class="n">children</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;point mass&#39;</span><span class="p">]:</span>
                <span class="n">val</span> <span class="o">+=</span> <span class="p">[</span><span class="n">child</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">+=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                <span class="p">)]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="s1">&#39;children&#39;</span><span class="p">,</span>
            <span class="n">val</span><span class="p">,</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">cli</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Success:&quot;</span><span class="p">]</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Simulation.get_children">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_children">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="nd">@cli</span><span class="p">(</span><span class="s1">&#39;starsmashertools&#39;</span><span class="p">)</span>
    <span class="nd">@clioptions</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Show children&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">cli</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of :class:`~.Simulation` objects that were used to create</span>
<span class="sd">        this simulation. For example, if this simulation is a dynamical</span>
<span class="sd">        simulation (``nrelax = 0``), then it has one child, which is the binary</span>
<span class="sd">        scan that it originated from. Similarly, a binary scan has two children,</span>
<span class="sd">        which are each the stellar relaxations that make up the two stars in the</span>
<span class="sd">        binary.</span>

<span class="sd">        If the children are already known because they ahve been saved in this </span>
<span class="sd">        simulation&#39;s :class:`~.archive.SimulationArchive`\, then the children</span>
<span class="sd">        will be recovered from the archive. Otherwise, :meth:`~._get_children`</span>
<span class="sd">        is called and the result is saved to the archive. You can edit the </span>
<span class="sd">        children in the archive using the ``starsmashertools`` CLI by selecting</span>
<span class="sd">        :meth:`~.set_children` in the main menu. This can save time on searching</span>
<span class="sd">        the file system for child simulations.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbose : bool, default = False</span>
<span class="sd">            If `True`\, debug messages will be printed to the console.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of the child simulations.</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`~.set_children`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        
        <span class="k">if</span> <span class="s1">&#39;children&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="s1">&#39;children&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">directory</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;point mass&#39;</span><span class="p">]:</span>
                    <span class="n">children</span> <span class="o">+=</span> <span class="p">[</span><span class="n">directory</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">children</span> <span class="o">+=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">get_simulation</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_children</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_children</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cli</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">child</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;point mass&#39;</span><span class="p">]:</span>
                    <span class="n">string</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;Star </span><span class="si">%d</span><span class="s2">: point mass&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;Star </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">directory</span><span class="p">)]</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">children</span></div>


<div class="viewcode-block" id="Simulation.get_start_file">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_start_file">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_start_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the path to the output file that this simulation started from,</span>
<span class="sd">        as identified by ``&#39;Simulation/start file&#39;`` in </span>
<span class="sd">        :mod:`~starsmashertools.preferences`\. If this simulation doesn&#39;t</span>
<span class="sd">        have a file matching that name, instead return the first output file </span>
<span class="sd">        this simulation produced. If this simulation has not produced any output</span>
<span class="sd">        files, a :py:class:`FileNotFoundError` is raised.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The path to the output file this simulation started from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="n">start_file_identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start file&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">start_file_identifier</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">outputfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outputfiles</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">outputfiles</span><span class="p">:</span> <span class="k">return</span> <span class="n">outputfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Cannot get start file because simulation has no output files and no file named &#39;</span><span class="si">%s</span><span class="s2">&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start_file_identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="Simulation.get_start_time">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_start_time">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_start_time</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True` then the simulations which are joined to this simulation</span>
<span class="sd">            will be considered. Otherwise only this simulation will be </span>
<span class="sd">            considered.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`~.units.Unit`</span>
<span class="sd">            The simulation time in seconds when this simulation started running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.units</span>
        <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outputfiles</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Simulation has no output files: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;s&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Simulation.get_current_time">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_current_time">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_current_time</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">use_logfiles</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain the time which the :class:`~.Simulation` is currently at.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        use_logfiles : bool, default = False</span>
<span class="sd">            If `True`\, only the simulation&#39;s log files are used, which will in</span>
<span class="sd">            general return larger time values than when using just the output</span>
<span class="sd">            files. If `False`\, this method is equivalent to the value of </span>
<span class="sd">            ``&#39;t&#39;`` in the header of the very last output file which was written</span>
<span class="sd">            in this simulation.</span>

<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True` then the simulations which are joined to this simulation</span>
<span class="sd">            will be considered. Otherwise only this simulation will be </span>
<span class="sd">            considered.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`~.units.Unit`</span>
<span class="sd">            The simulation time in seconds when this simulation stopped running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.units</span>

        <span class="k">if</span> <span class="n">use_logfiles</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">logfile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logfiles</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">):</span>
                <span class="n">time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">logfile</span><span class="o">.</span><span class="n">get_current_time</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outputfiles</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">)</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">time</span> <span class="o">*=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Simulation.get_stop_time">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_stop_time">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_stop_time</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain the time at which the :class:`~.Simulation` is expected to stop </span>
<span class="sd">        running. This is set by the ``&#39;tf&#39;`` parameter in the StarSmasher input </span>
<span class="sd">        file ``sph.input``\.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True`\, the joined simulations will be included.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tf : :class:`~.units.Unit`</span>
<span class="sd">            The stop time for this Simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.units</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;tf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">time</span>
        <span class="k">if</span> <span class="n">include_joined</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">simulation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joined_simulations</span><span class="p">:</span>
                <span class="n">tf</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">simulation</span><span class="p">[</span><span class="s1">&#39;tf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">simulation</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tf</span></div>


<div class="viewcode-block" id="Simulation.started_from">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.started_from">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">started_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span> <span class="p">:</span> <span class="s1">&#39;starsmashertools.lib.simulation.Simulation&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        simulation : :class:`~.Simulation`</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            `True` if this simulation was started from ``simulation``\, in the </span>
<span class="sd">            sense that this simulation both has a &quot;start file&quot; (returned by</span>
<span class="sd">            :meth:`~.get_start_file`\) and the start file is identical to one of</span>
<span class="sd">            the output files in ``simulation``\.</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`~.get_file`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        
        <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span><span class="p">({</span>
            <span class="s1">&#39;simulation&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Simulation</span><span class="p">],</span>
        <span class="p">})</span>

        <span class="n">path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start file&#39;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">outputfiles</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_outputfiles</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">size1</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_file</span> <span class="ow">in</span> <span class="n">outputfiles</span><span class="p">:</span>
            <span class="n">size2</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">size1</span> <span class="o">!=</span> <span class="n">size2</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">filecmp</span><span class="o">.</span><span class="n">cmp</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">_file</span><span class="p">,</span> <span class="n">shallow</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

        
<div class="viewcode-block" id="Simulation.get_file">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_file">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_file</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">filename_or_pattern</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">recursive</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search the simulation directory for a file or files that match a</span>
<span class="sd">        pattern.</span>

<span class="sd">        Only returns files belonging to this simulation&#39;s directory, and ignores</span>
<span class="sd">        any joined simulations&#39; directories.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename_or_pattern : str</span>
<span class="sd">            A file name in the simulation directory or a pattern (e.g., </span>
<span class="sd">            ``out*.sph``\)</span>
<span class="sd">        recursive : bool, default = True</span>
<span class="sd">            If `True`\, searches all sub directories in the simulation. If</span>
<span class="sd">            `False`\, searches just the top level simulation directory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of paths which match the given pattern or filenames.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span> <span class="n">_path</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;**&#39;</span><span class="p">,</span> <span class="n">filename_or_pattern</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">_path</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename_or_pattern</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span></div>


<div class="viewcode-block" id="Simulation.get_outputfiles">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_outputfiles">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_outputfiles</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">pattern</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Pref</span><span class="p">(</span><span class="s1">&#39;get_outputfiles.output files&#39;</span><span class="p">,</span> <span class="s1">&#39;out*.sph&#39;</span><span class="p">),</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">exclude_joined</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of output file locations. If this simulation has any</span>
<span class="sd">        joined simulations, then each of those simulations&#39; output file paths</span>
<span class="sd">        are returned as well. The result is sorted by simulation times.</span>
<span class="sd">        </span>
<span class="sd">        For joined simulations, it is possible that one or more of the joined</span>
<span class="sd">        simulations are a &quot;continuation&quot; of this current simulation, or this</span>
<span class="sd">        current simulation is a &quot;continuation&quot; of one of its joined simulations.</span>
<span class="sd">        Here, a &quot;continuation&quot; is a simulation which was started by copying an</span>
<span class="sd">        output file from another simulation and calling it </span>
<span class="sd">        ``&#39;restartrad.sph.orig&#39;``\, without changing the simulation type </span>
<span class="sd">        (``&#39;nrelax&#39;`` in ``sph.input``\). Only the joined simulations will be </span>
<span class="sd">        checked for a file which is identical to this simulation&#39;s </span>
<span class="sd">        ``restartrad.sph.orig`` file (the actual name depends on the user&#39;s </span>
<span class="sd">        preferences, in :mod:`~starsmashertools.preferences`\).</span>
<span class="sd">        </span>
<span class="sd">        For example, consider that simulation ``A`` produced output files </span>
<span class="sd">        ``&#39;A/out0000.sph&#39;``\, ``&#39;A/out0001.sph&#39;``\, and ``&#39;A/out0002.sph&#39;``\. </span>
<span class="sd">        Then, simulation ``B`` was created by copying ``&#39;A/out0001.sph&#39;`` and </span>
<span class="sd">        renaming it as ``&#39;B/restartrad.sph.orig&#39;``\, and then </span>
<span class="sd">        ``&#39;B/restartrad.sph.orig&#39;`` was copied to ``&#39;B/restartrad.sph&#39;`` before</span>
<span class="sd">        starting simulation ``B``\. Suppose then that simulation ``B`` creates </span>
<span class="sd">        output files ``&#39;B/out0001.sph&#39;``\, ``&#39;B/out0002.sph&#39;``\, and </span>
<span class="sd">        ``&#39;B/out0003.sph&#39;`` and that simulations ``A`` and ``B`` are joined. The</span>
<span class="sd">        expected output of this function would be </span>
<span class="sd">        ``[&#39;A/out0000.sph&#39;, &#39;B/out0001.sph&#39;, &#39;B/out0002.sph&#39;, </span>
<span class="sd">        &#39;B/out0003.sph&#39;]``\. </span>
<span class="sd">        Note that the actual files simulation ``B`` would create depends on its</span>
<span class="sd">        input parameters, such as ``&#39;dtout&#39;`` in ``&#39;B/sph.input&#39;``\.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pattern : str, default = Pref(&#39;get_outputfiles.output files&#39;, &#39;out*.sph&#39;)</span>
<span class="sd">            Passed directly to :meth:`~.get_file`\.</span>
<span class="sd">        </span>
<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True`\, the joined simulations will be included in the search.</span>
<span class="sd">            Otherwise, only this simulation will be searched.</span>

<span class="sd">        exclude_joined : list, tuple, default = []</span>
<span class="sd">            A list of :class:`~.Simulation` objects to exclude when working with</span>
<span class="sd">            the joined simulations.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of output file paths belonging to this simulation and any</span>
<span class="sd">            joined simulations, unsorted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.midpoint</span>
        
        <span class="c1"># We expect for StarSmasher to always write output files sequentially.</span>
        <span class="c1"># The sequence may or may not start at out0000.sph. The names of the</span>
        <span class="c1"># output files may vary in the number of padded zeros. The user may also</span>
        <span class="c1"># specify that the output files are a different pattern than &quot;out*.sph&quot;.</span>
        <span class="c1">#</span>
        <span class="c1"># Thus, we search the names of all the files for numbers which change</span>
        <span class="c1"># sequentially.</span>

        <span class="n">reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">reg</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span>
                    <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">span</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">span</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
                    <span class="n">numbers</span><span class="p">[</span><span class="n">span</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">files</span><span class="p">[</span><span class="n">span</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">numbers</span><span class="p">[</span><span class="n">span</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
                <span class="n">files</span><span class="p">[</span><span class="n">span</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">match</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">numbers</span><span class="p">:</span>
            <span class="c1"># No numeric patterns found. Fallback to sorting by mtime</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
            <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">matches</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There should be at least 1 set of numbers whose span is the</span>
            <span class="c1"># same among all the output files. Weed out the ones where this</span>
            <span class="c1"># isn&#39;t the case</span>
            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">numbers</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
            <span class="n">numbers</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">numbers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="n">maxlen</span><span class="p">}</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">numbers</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to find sequential numeric tags in the StarSmasher output files of pattern &#39;</span><span class="si">%s</span><span class="s2">&#39;: none of the numeric tags have the same length as the number of output files.&quot;</span> <span class="o">%</span> <span class="n">pattern</span><span class="p">)</span>

            <span class="c1"># Search for sequential listings. There should be at least 1.</span>
            <span class="c1"># Also sort the numbers dict</span>
            <span class="n">longest_len</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">longest</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">numbers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">longest_len</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">longest</span> <span class="o">=</span> <span class="n">key</span>
                        <span class="n">longest_len</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">v2</span><span class="o">-</span><span class="n">v1</span> <span class="o">!=</span> <span class="n">diff</span><span class="p">:</span> <span class="k">break</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">longest_len</span><span class="p">:</span>
                        <span class="n">longest</span> <span class="o">=</span> <span class="n">key</span>
                        <span class="n">longest_len</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">break</span>
            
            <span class="k">if</span> <span class="n">longest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">longest_len</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="n">longest</span><span class="p">]),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Resort to basic matching</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
                <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">matches</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_joined</span><span class="p">:</span> <span class="k">return</span> <span class="n">matches</span>

        <span class="c1"># If we have other simulations joined to us, we need to include their</span>
        <span class="c1"># output files in the results.</span>
        <span class="c1">#</span>
        <span class="c1"># The block of output files a simulation produces is bounded by a</span>
        <span class="c1"># starting and ending time. Thus, we can typically order the outputs</span>
        <span class="c1"># according to the starting and ending times of the simulations.</span>
        <span class="c1">#</span>
        <span class="c1"># However, in some cases, simulation B may have started before</span>
        <span class="c1"># simulation A&#39;s ending time. This is a type of &quot;overwrite&quot; behavior. We</span>
        <span class="c1"># use B&#39;s outputs instead of A&#39;s over the timespan of B. If A has more</span>
        <span class="c1"># output after B&#39;s ending time, we include those files too.</span>

        <span class="c1"># Recursively find all the blocks of output files in all joined</span>
        <span class="c1"># simulations.</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="p">[[</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_start_time</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_stop_time</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">matches</span><span class="p">,</span>
        <span class="p">]]</span>
        <span class="k">for</span> <span class="n">joined</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joined_simulations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">joined</span> <span class="ow">in</span> <span class="n">exclude_joined</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">joined</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># Just in case</span>
            <span class="n">blocks</span> <span class="o">+=</span> <span class="p">[[</span>
                <span class="n">joined</span><span class="p">,</span>
                <span class="n">joined</span><span class="o">.</span><span class="n">get_start_time</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
                <span class="n">joined</span><span class="o">.</span><span class="n">get_stop_time</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
                <span class="n">joined</span><span class="o">.</span><span class="n">get_outputfiles</span><span class="p">(</span>
                    <span class="n">include_joined</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">exclude_joined</span> <span class="o">=</span> <span class="n">exclude_joined</span> <span class="o">+</span> <span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">],</span>
                <span class="p">),</span>
            <span class="p">]]</span>
        
        <span class="c1"># Order the blocks by the simulations&#39; starting times</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">block</span><span class="p">:</span> <span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="c1">#matches = blocks[0][3]</span>
        <span class="c1"># Resolve conflicts (do overwriting)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">blocks</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span> <span class="c1"># current start &lt; previous end</span>
                <span class="c1"># Locate the last output that has a time less than the current</span>
                <span class="c1"># start time.</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">midpoint</span><span class="o">.</span><span class="n">Midpoint</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">m</span><span class="o">.</span><span class="n">set_criteria</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">idx1</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">favor</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="n">return_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                
                
                <span class="k">if</span> <span class="n">block</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span> <span class="c1"># current stop &lt; previous stop</span>
                    <span class="c1"># Only overwrite the time period current stop - current</span>
                    <span class="c1"># start. Split the previous block into two.</span>

                    <span class="n">m</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">midpoint</span><span class="o">.</span><span class="n">Midpoint</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">set_criteria</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">block</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">block</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">favor</span> <span class="o">=</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="n">return_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                    
                    <span class="n">totrim</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">idx1</span><span class="p">:]</span>
                    <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][:</span><span class="n">idx1</span><span class="p">]</span>
                    <span class="n">blocks</span> <span class="o">+=</span> <span class="p">[[</span>
                        <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">totrim</span><span class="p">,</span>
                    <span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># Simple trimming of previous block</span>
                    <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][:</span><span class="n">idx1</span><span class="p">]</span>
        
        <span class="c1"># Final sorting of the blocks</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">block</span><span class="p">:</span><span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        
        <span class="c1"># Stitch the blocks together to get the result</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">block</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">]))</span></div>

    
<div class="viewcode-block" id="Simulation.compress">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.compress">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">filename</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">patterns</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">Pref</span><span class="p">(</span><span class="s1">&#39;state files&#39;</span><span class="p">),</span>
            <span class="n">recursive</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">delete</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">delete_after</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a compressed version of the Simulation. File creation times are</span>
<span class="sd">        preserved.</span>

<span class="sd">        Does not compress any joined simulations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, None, default = None</span>
<span class="sd">            The name of the resulting compressed file. If `None` then the name</span>
<span class="sd">            of the file will be the name of the simulation directory with</span>
<span class="sd">            ``&#39;.zip&#39;`` on the end.</span>
<span class="sd">        </span>
<span class="sd">        patterns : list, default = Pref(&#39;state files&#39;)</span>
<span class="sd">            File name patterns to include in the compression.</span>

<span class="sd">        recursive : bool, default = True</span>
<span class="sd">            If `True`\, subdirectories are also searched for files matching the</span>
<span class="sd">            given patterns. If `False`\, only searches the main simulation</span>
<span class="sd">            directory.</span>

<span class="sd">        delete : bool, default = True</span>
<span class="sd">            If `True`\, the files which are compressed are deleted.</span>

<span class="sd">        delete_after : bool, default = True</span>
<span class="sd">            If `True`\, compressed files are deleted only after all files have</span>
<span class="sd">            been compressed. If `False`\, each file is deleted after it has</span>
<span class="sd">            been compressed. If ``delete = False`` this option is ignored.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Remaining keyword arguments are passed directly to </span>
<span class="sd">            :meth:`starsmashertools.helpers.compressiontask.CompressionTask.compress`\.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`~.decompress`</span>
<span class="sd">        :meth:`starsmashertools.helpers.compressiontask.CompressionTask.compress`</span>
<span class="sd">        :mod:`starsmashertools.preferences`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.compressiontask</span>
        
        <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">]))</span>
        
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">_path</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_path</span><span class="p">]</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_compression_filename</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_task</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">compressiontask</span><span class="o">.</span><span class="n">CompressionTask</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_task</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="n">delete</span><span class="p">,</span> <span class="n">delete_after</span><span class="o">=</span><span class="n">delete_after</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_task</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Simulation.decompress">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.decompress">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">decompress</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">filename</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">delete</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decompress the simulation from the given filename.</span>

<span class="sd">        Does not decompress any joined simulations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, None default = None</span>
<span class="sd">            The filename to decompress. If `None`\, the simulation directory is</span>
<span class="sd">            searched for a compressed file whose path ends with ``&#39;.zip&#39;``\.</span>
<span class="sd">            The file chosen is one which has a ``compression.sstools`` file</span>
<span class="sd">            included in it, which created by</span>
<span class="sd">            :meth:`starsmashertools.helpers.compressiontask.CompressionTask.compress`\.</span>

<span class="sd">        delete : bool, default = True</span>
<span class="sd">            If `True`\, the compressed file is deleted after decompression.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Remaining keyword arguments are passed directly to</span>
<span class="sd">            `starsmashertools.helpers.compressiontask.CompressionTask.decompress`\.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`compress`</span>
<span class="sd">        :meth:`starsmashertools.helpers.compresisontask.CompressionTask.decompress`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.compressiontask</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot decompress a simulation that is not compressed&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_task</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">compressiontask</span><span class="o">.</span><span class="n">CompressionTask</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_compression_filename</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compression_task</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="n">delete</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compression_task</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Failed to find any valid compressed files in directory &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span></div>


<div class="viewcode-block" id="Simulation.get_size">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_size">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The size of the simulation in bytes. Does not include any joined</span>
<span class="sd">            simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">get_directory_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span></div>







    <span class="c1">###</span>
    <span class="c1"># Simulation outputs</span>
    <span class="c1">###</span>
    
<div class="viewcode-block" id="Simulation.get_output_iterator">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_output_iterator">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_output_iterator</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">start</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">stop</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">step</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a :class:`~.output.OutputIterator` containing all the </span>
<span class="sd">        :class:`~.output.Output` objects present in this simulation.</span>

<span class="sd">        The iterator includes output files from any joined simulations.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : int, None, default = None</span>
<span class="sd">            Passed directly to :meth:`~.get_output`\.</span>

<span class="sd">        stop : int, None, default = None</span>
<span class="sd">            Passed directly to :meth:`~.get_output`\.</span>

<span class="sd">        step : int, None, default = None</span>
<span class="sd">            Passed directly to :meth:`~.get_output`\.</span>

<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True`\, the joined simulations will be included in the search.</span>
<span class="sd">            Otherwise, only this simulation will be searched. Passed directly to</span>
<span class="sd">            :meth:`~.get_output`\.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Other keyword arguments are passed directly to </span>
<span class="sd">            :class:`~.output.OutputIterator`\.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        iterator</span>
<span class="sd">            The created :class:`~.output.OutputIterator` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.output</span>
        <span class="c1"># Now that we have all the file names, we can create an output iterator</span>
        <span class="c1"># from them</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_generator</span><span class="p">(</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">OutputIterator</span><span class="p">(</span>
            <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">],</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Simulation.get_output_at_time">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_output_at_time">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_output_at_time</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">time</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Unit</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the :class:`~.output.Output` object of this simulation whose time</span>
<span class="sd">        best matches the given time. Raises a :py:class:`ValueError` if the </span>
<span class="sd">        given time is out of bounds.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : int, float, :class:`~.units.Unit`</span>
<span class="sd">            The simulation time to locate. If an `int` or `float` are given then</span>
<span class="sd">            this value represents time in the simulation units. If a </span>
<span class="sd">            :class:`~.units.Unit` is given, it will be converted to this </span>
<span class="sd">            simulation&#39;s time unit from :attr:`~.units`.</span>

<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True`\, the joined simulations will be included in the search.</span>
<span class="sd">            Otherwise, only this simulation will be searched.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`~.output.Output`</span>
<span class="sd">            The :class:`~.output.Output` object closest to the given time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.midpoint</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.string</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Unit</span><span class="p">):</span>
            <span class="n">time</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
            <span class="c1">#time = float(time.convert(self.units[&#39;t&#39;].label))</span>
        
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">outputs</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot find output at time </span><span class="si">%f</span><span class="s2"> because there are no output files in simulation &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)))</span>
        
        <span class="n">conversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        
        <span class="n">tend</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">conversion</span>
        
        <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">tend</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time </span><span class="si">%s</span><span class="s2"> is out of bounds [0, </span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">tend</span><span class="p">)))</span>
        
        <span class="n">m</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">midpoint</span><span class="o">.</span><span class="n">Midpoint</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_criteria</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">output</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">*</span> <span class="n">conversion</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">output</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">*</span> <span class="n">conversion</span> <span class="o">==</span> <span class="n">time</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">output</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read_from_header</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">*</span> <span class="n">conversion</span> <span class="o">&gt;</span> <span class="n">time</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="Simulation.get_output_generator">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_output_generator">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_output_generator</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">start</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">stop</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">step</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">times</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Unit</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">time_range</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">indices</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain a generator of :class:`~.output.Output` objects associated with </span>
<span class="sd">        this simulation. Returns all outputs if no arguments are specified.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : int, None, default = None</span>
<span class="sd">            The starting index of a slice of the list of all output files.</span>
<span class="sd">        </span>
<span class="sd">        stop : int, None, default = None</span>
<span class="sd">            The ending index in the slice of the list of all output files.</span>
<span class="sd">        </span>
<span class="sd">        step : int, None, default = None</span>
<span class="sd">            How many output files to skip in the slice.</span>
<span class="sd">        </span>
<span class="sd">        times : int, float, :class:`~.units.Unit`\, list, tuple, :class:`numpy.ndarray`\, default = None</span>
<span class="sd">            If given, returns the output files that are closest to the given</span>
<span class="sd">            simulation time or collection of times. This can possibly include</span>
<span class="sd">            duplicate items.</span>

<span class="sd">        time_range : list, tuple, None, :class:`numpy.ndarray`\, default = None</span>
<span class="sd">            If not `None`\, this must be an iterable of 2 elements, the first </span>
<span class="sd">            being the lower time bound and the second being the upper time </span>
<span class="sd">            bound. If either bounds are `None` then only one bound will be used.</span>
<span class="sd">        </span>
<span class="sd">        indices : list, tuple, :class:`numpy.ndarray`\, default = None</span>
<span class="sd">            If given, returns the output files at each index from the result of</span>
<span class="sd">            :meth:`~.get_outputfiles`\.</span>

<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True`\, the joined simulations will be included in the search.</span>
<span class="sd">            Otherwise, only this simulation will be searched.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        generator</span>
<span class="sd">            A generator of :class:`~.output.Output` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">starsmashertools.lib.output</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.string</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outputfiles</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">)</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">object</span><span class="p">)</span>

        <span class="c1"># We accept the input if only either</span>
        <span class="c1">#    - (start, stop, step) are valid and not None, or</span>
        <span class="c1">#    - Exactly one of times, time_range, or indices are not None</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;times&#39;</span> <span class="p">:</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;time_range&#39;</span> <span class="p">:</span> <span class="n">time_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;indices&#39;</span> <span class="p">:</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">num_used</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">if</span> <span class="n">item</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">modes</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="k">if</span> <span class="n">num_used</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Use slicing</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># User is intending to just get a single index</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="n">filenames</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="n">s</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">modes</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_at_time</span><span class="p">(</span>
                        <span class="n">time</span><span class="p">,</span>
                        <span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_at_time</span><span class="p">(</span>
                    <span class="n">times</span><span class="p">,</span>
                    <span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">modes</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="n">filenames</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">modes</span><span class="p">[</span><span class="s1">&#39;time_range&#39;</span><span class="p">]:</span>
            <span class="n">tlo</span><span class="p">,</span> <span class="n">thi</span> <span class="o">=</span> <span class="n">time_range</span>
            <span class="n">idx0</span><span class="p">,</span> <span class="n">idx1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">tlo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_at_time</span><span class="p">(</span>
                    <span class="n">tlo</span><span class="p">,</span>
                    <span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span>
                <span class="p">)</span>
                <span class="n">idx0</span> <span class="o">=</span> <span class="n">filenames</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">thi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_at_time</span><span class="p">(</span>
                    <span class="n">thi</span><span class="p">,</span>
                    <span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span>
                <span class="p">)</span>
                <span class="n">idx1</span> <span class="o">=</span> <span class="n">filenames</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx0</span> <span class="o">==</span> <span class="n">idx1</span><span class="p">:</span> <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="n">filenames</span><span class="p">[</span><span class="n">idx0</span><span class="p">:</span><span class="n">idx1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mode specified. Check your keyword arguments.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Simulation.get_output">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_output">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="nd">@cli</span><span class="p">(</span><span class="s1">&#39;starsmashertools&#39;</span><span class="p">)</span>
    <span class="nd">@clioptions</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Show output files&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_output</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">start</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">stop</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">step</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">times</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">Unit</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">time_range</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">indices</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">cli</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The same as :meth:`~.get_output_generator`\, except the resulting</span>
<span class="sd">        generator is consumed into a list.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list, :class:`~.output.Output`</span>
<span class="sd">            A :py:class:`list` of :class:`~.output.Output` objects. If there is</span>
<span class="sd">            only a single item, only that item is returned (instead of a list).</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`~.get_output_generator`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_output_generator</span><span class="p">(</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">,</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">times</span><span class="p">,</span>
            <span class="n">time_range</span> <span class="o">=</span> <span class="n">time_range</span><span class="p">,</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">,</span>
        <span class="p">))</span>
        
        <span class="k">if</span> <span class="n">cli</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">starsmashertools.bintools.page</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_formatted_string</span><span class="p">(</span><span class="s1">&#39;cli&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">bintools</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">PAGEBREAK</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">get_formatted_string</span><span class="p">(</span><span class="s1">&#39;cli&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
<div class="viewcode-block" id="Simulation.get_output_headers">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_output_headers">[docs]</a>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_output_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read all the headers of the output files in this simulation and return</span>
<span class="sd">        them as a dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : list</span>
<span class="sd">            The keys to query the output file headers for.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        kwargs : dict</span>
<span class="sd">            Extra keyword arguments passed to :meth:`~.get_output_iterator`\. </span>
<span class="sd">            Note that keyword ``return_headers`` is always `True` and </span>
<span class="sd">            ``return_data`` is always `False`\. Keyword ``asynchronous`` is set </span>
<span class="sd">            to `False` by default because reading headers is often faster that </span>
<span class="sd">            way.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Each key is a :class:`~.output.Output` object and each value is the</span>
<span class="sd">            entire header.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;return_headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;return_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;asynchronous&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;asynchronous&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_iterator</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">output</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">header</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Simulation.get_energyfiles">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_energyfiles">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_energyfiles</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">skip_rows</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the :class:`~.energyfile.EnergyFile` objects associated with this </span>
<span class="sd">        simulation.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        skip_rows : int, None, default = None</span>
<span class="sd">            Only read every Nth line of each energy file. If `None`\, uses the </span>
<span class="sd">            default value in :meth:`~.energyfile.EnergyFile.__init__`\.</span>

<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True`\, the joined simulations will be included in the search.</span>
<span class="sd">            Otherwise, only this simulation will be searched.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of :class:`~.energyfile.EnergyFile` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.energyfile</span>
        <span class="n">energyfiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">logfile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logfiles</span><span class="p">(</span><span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">):</span>
            <span class="n">energyfiles</span> <span class="o">+=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">energyfile</span><span class="o">.</span><span class="n">EnergyFile</span><span class="p">(</span>
                <span class="n">logfile</span><span class="p">,</span>
                <span class="n">skip_rows</span> <span class="o">=</span> <span class="n">skip_rows</span><span class="p">,</span>
            <span class="p">)]</span>
        <span class="k">return</span> <span class="n">energyfiles</span></div>

        

<div class="viewcode-block" id="Simulation.get_energy">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_energy">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_energy</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">sort</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">skip_rows</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain all the simulation energies as a function of simulation time.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        sort : str, None, default = None</span>
<span class="sd">            Sort the resulting dictionary by the given string key. Raises an </span>
<span class="sd">            error if that key doesn&#39;t exist.</span>

<span class="sd">        skip_rows : int, None, default = None</span>
<span class="sd">            Only read every :math:`\\mathrm{N^{th}}` line of each energy file. </span>
<span class="sd">            If `None`\, uses the default value in </span>
<span class="sd">            :meth:`~.energyfile.EnergyFile.__init__`\.</span>

<span class="sd">        include_joined : bool, default = True</span>
<span class="sd">            If `True`\, the joined simulations will be included in the search.</span>
<span class="sd">            Otherwise, only this simulation will be searched.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict or None</span>
<span class="sd">            A dictionary of :class:`numpy.ndarray`\. If no energy files were </span>
<span class="sd">            found, returns `None` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">energyfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energyfiles</span><span class="p">(</span>
            <span class="n">skip_rows</span> <span class="o">=</span> <span class="n">skip_rows</span><span class="p">,</span>
            <span class="n">include_joined</span> <span class="o">=</span> <span class="n">include_joined</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">energyfiles</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

        <span class="n">expected_keys</span> <span class="o">=</span> <span class="n">energyfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">from_different_simulation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">energyfile</span> <span class="ow">in</span> <span class="n">energyfiles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">energyfile</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">expected_keys</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">from_different_simulation</span> <span class="o">+=</span> <span class="p">[</span><span class="n">energyfile</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">from_different_simulation</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The following energy files were detected as being from a different simulation: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">from_different_simulation</span><span class="p">))</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">expected_keys</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">energyfile</span> <span class="ow">in</span> <span class="n">energyfiles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">energyfile</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sort</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot sort by key &#39;</span><span class="si">%s</span><span class="s2">&#39; because it is not one of the keys in the dictionary. Possible keys are: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()]))</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="Simulation.get_flux">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.get_flux">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="k">def</span> <span class="nf">get_flux</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">outputs</span><span class="p">,</span>
            <span class="n">parallel</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.lib.flux</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.asynchronous</span>

        <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span><span class="p">({</span>
            <span class="s1">&#39;outputs&#39;</span> <span class="p">:</span> <span class="p">[</span>
                <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Output</span><span class="p">,</span>
                <span class="nb">list</span><span class="p">,</span>
                <span class="nb">tuple</span><span class="p">,</span>
                <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">OutputIterator</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">})</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Output</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Output</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All elements of the given outputs iterable must be of type &#39;starsmashertools.lib.output.Output&#39;, but received &#39;</span><span class="si">%s</span><span class="s2">&#39; at element </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="c1">#results = []</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1">#return results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">OutputIterator</span><span class="p">):</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">asynchronous</span><span class="o">.</span><span class="n">ParallelIterator</span><span class="p">(</span>
                <span class="n">starsmashertools</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                <span class="p">[[</span><span class="n">output</span><span class="p">]</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">],</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">],</span>
            <span class="p">)</span></div>



    <span class="k">if</span> <span class="n">has_matplotlib</span><span class="p">:</span>
<div class="viewcode-block" id="Simulation.plot_energy">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.plot_energy">[docs]</a>
        <span class="nd">@api</span>
        <span class="nd">@cli</span><span class="p">(</span><span class="s1">&#39;starsmashertools&#39;</span><span class="p">)</span>
        <span class="nd">@clioptions</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Plot energies&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">plot_energy</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">cli</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">scale</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
            <span class="kn">import</span> <span class="nn">starsmashertools.mpl</span>

            <span class="c1"># Read all the energy*.sph files</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">(</span><span class="n">sort</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sharex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sharex&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nrows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

            <span class="n">tunit</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">tunit</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">tunit</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">energies</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">align_ylabels</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cli</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="n">fig</span></div>

            
<div class="viewcode-block" id="Simulation.plot_animation">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.plot_animation">[docs]</a>
        <span class="nd">@api</span>
        <span class="nd">@cli</span><span class="p">(</span><span class="s1">&#39;starsmashertools&#39;</span><span class="p">)</span>
        <span class="nd">@clioptions</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Plot animation&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">plot_animation</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">x</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span>
                <span class="n">y</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span>
                <span class="n">logx</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">logy</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">cli</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="kn">import</span> <span class="nn">starsmashertools.mpl</span>
            <span class="kn">import</span> <span class="nn">starsmashertools.mpl.animation</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">logx</span><span class="p">:</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;log &#39;</span><span class="o">+</span><span class="n">xlabel</span>
            <span class="k">if</span> <span class="n">logy</span><span class="p">:</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;log &#39;</span><span class="o">+</span><span class="n">ylabel</span>
                
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

            <span class="n">all_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span>
            
            <span class="n">artist</span> <span class="o">=</span> <span class="n">all_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">logx</span> <span class="o">=</span> <span class="n">logx</span><span class="p">,</span>
                <span class="n">logy</span> <span class="o">=</span> <span class="n">logy</span><span class="p">,</span>
            <span class="p">)</span>
            
            <span class="n">label</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>
                <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">time_label</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span>
                <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># determine the appropriate unit to use</span>
            <span class="n">t</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_time</span><span class="p">(</span>
                    <span class="n">use_logfiles</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_time</span><span class="p">(</span>
                        <span class="n">use_logfiles</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">include_joined</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
                    
            <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">tunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span><span class="o">.</span><span class="n">label</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">tunit</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span><span class="o">.</span><span class="n">label</span>
            <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">all_output</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_output</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="n">artist</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

                <span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
                <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">tunit</span><span class="p">)</span>
                <span class="n">time_label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;t = </span><span class="si">%10g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tunit</span><span class="p">))</span>
            
            <span class="n">update</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ani</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">Player</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">maxi</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">all_output</span><span class="p">),</span>
                <span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">30.</span> <span class="o">*</span> <span class="mf">1000.</span><span class="p">),</span> <span class="c1"># framerate in ms</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">cli</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="n">ani</span></div>



<div class="viewcode-block" id="Simulation.join">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.join">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="nd">@cli</span><span class="p">(</span><span class="s1">&#39;starsmashertools&#39;</span><span class="p">)</span>
    <span class="nd">@clioptions</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Concatenate simulations&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">other</span><span class="p">,</span>
            <span class="n">cli</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge two simulations of the same type together, by having</span>
<span class="sd">        starsmashertools retrieve the output files of all joined simulations</span>
<span class="sd">        whenever the ``include_joined`` flag is set to `True` (default) in</span>
<span class="sd">        :meth:`~.get_output`\, :meth:`~.get_output_at_time`\, </span>
<span class="sd">        :meth:`~.get_output_iterator`\, :meth:`~.get_outputfiles`\, </span>
<span class="sd">        :meth:`~.get_logfiles`\, :meth:`~.get_energyfiles`\, and </span>
<span class="sd">        :meth:`~.get_energy`\.</span>

<span class="sd">        The ``restartrad.sph.orig`` file (or equivalent from </span>
<span class="sd">        :mod:`starsmashertools.preferences`\) must originate from ``other``\,</span>
<span class="sd">        or ``other`` must have a ``restartrad.sph.orig`` file which originates</span>
<span class="sd">        from this simulation. Otherwise, a :class:`~.JoinError` is raised.</span>

<span class="sd">        To undo this operation, use :meth:`~.split`\.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : str, :class:`~.Simulation`</span>
<span class="sd">            The other simulation to merge with, or a path to a simulation</span>
<span class="sd">            directory.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`~.split`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">starsmashertools</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>

        <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span><span class="p">({</span>
            <span class="s1">&#39;other&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Simulation</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="p">})</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">get_simulation</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Cannot join simulations &#39;</span><span class="si">%s</span><span class="s2">&#39; and &#39;</span><span class="si">%s</span><span class="s2">&#39; because they are the same simulation&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cli</span><span class="p">:</span> <span class="k">return</span> <span class="n">message</span>
            <span class="k">raise</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">JoinError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started_from</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">started_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">JoinError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        
        <span class="n">other_path</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
            <span class="n">other</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">our_path</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;joined simulations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">:</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="s1">&#39;joined simulations&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">other_path</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="s1">&#39;joined simulations&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">other_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="s1">&#39;joined simulations&#39;</span><span class="p">,</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="p">[</span><span class="n">other_path</span><span class="p">],</span>
                <span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;joined simulations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">archive</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="s1">&#39;joined simulations&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">our_path</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="s1">&#39;joined simulations&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">our_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">other</span><span class="o">.</span><span class="n">archive</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="s1">&#39;joined simulations&#39;</span><span class="p">,</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="p">[</span><span class="n">our_path</span><span class="p">],</span>
                <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cli</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Success&quot;</span></div>



<div class="viewcode-block" id="Simulation.split">
<a class="viewcode-back" href="../../../_autosummary/starsmashertools.lib.simulation.html#starsmashertools.lib.simulation.Simulation.split">[docs]</a>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@api</span>
    <span class="nd">@cli</span><span class="p">(</span><span class="s1">&#39;starsmashertools&#39;</span><span class="p">)</span>
    <span class="nd">@clioptions</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Detach concatenated simulations&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">which</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cli</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The opposite of :meth:`~.join`\. Split this simulation apart from each</span>
<span class="sd">        simulation it is joined to. Any simulation joined to this one will also</span>
<span class="sd">        be split apart from it.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        which : str, :class:`~.Simulation`\, None, default = None</span>
<span class="sd">            Which simulation to split from the joined simulations. If a `str` is</span>
<span class="sd">            given, it must match exactly one of the directory strings stored in</span>
<span class="sd">            this simulation&#39;s archive file. If a :class:`~.Simulation` is given,</span>
<span class="sd">            it must have a directory which matches one of those directory</span>
<span class="sd">            strings. Otherwise, if `None`\, this simulation will be split apart </span>
<span class="sd">            from all of its joined simulations.</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`~.join`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span><span class="p">({</span>
            <span class="s1">&#39;which&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Simulation</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span>
        <span class="p">})</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joined_simulations</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># This is the case of no joined simulations</span>
            <span class="k">if</span> <span class="n">cli</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;This simulation has no joined simulations&quot;</span>
            <span class="k">return</span>

        <span class="n">archive_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="s1">&#39;joined simulations&#39;</span><span class="p">]</span>
        <span class="n">directories</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">archive_value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">to_update</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">simulation</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">if</span> <span class="n">which</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cli</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;No simulation identified by which = &#39;</span><span class="si">%s</span><span class="s2">&#39;. The joined simulations are identified as:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">show_joined_simulations</span><span class="p">(</span><span class="n">cli</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span> <span class="o">%</span> <span class="n">which</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;No simulation identified by which = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">which</span><span class="p">)</span>

            <span class="n">directories</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">which</span><span class="p">)</span>
            <span class="n">to_update</span> <span class="o">=</span> <span class="p">[</span><span class="n">which</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">Simulation</span><span class="p">):</span>
            <span class="n">has_warnings</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">simulations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">simulations</span> <span class="o">+=</span> <span class="p">[</span><span class="n">starsmashertools</span><span class="o">.</span><span class="n">get_simulation</span><span class="p">(</span><span class="n">directory</span><span class="p">)]</span>
                <span class="k">except</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">InvalidDirectoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">has_warnings</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">simulations</span> <span class="o">+=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
                    
            <span class="k">if</span> <span class="n">which</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">simulations</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;No simulation identified by which = &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">which</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">has_warnings</span><span class="p">:</span> <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot; You have warnings related to the joined simulations. Try to resolve those first before trying again. If you are using the CLI, try using the &#39;show_joined_simulations&#39; method and copying one of the strings to use as the value for &#39;which&#39;.&quot;</span>
                <span class="k">if</span> <span class="n">cli</span><span class="p">:</span> <span class="k">return</span> <span class="n">message</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">simulations</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">which</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">directories</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">to_update</span> <span class="o">=</span> <span class="p">[</span><span class="n">which</span><span class="o">.</span><span class="n">directory</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_update</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">directories</span><span class="p">)</span>
            <span class="n">directories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Unrecognized input for keyword &#39;which&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">which</span><span class="p">))</span>

        <span class="n">archive_value</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">directories</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="s1">&#39;joined simulations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">archive_value</span>

        <span class="c1"># Update the joined simulations&#39; joined simulations (removing oursel</span>
        <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">to_update</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">simulation</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">get_simulation</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">InvalidDirectoryError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">simulation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">which</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cli</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Success&quot;</span></div>

        
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="nd">@cli</span><span class="p">(</span><span class="s1">&#39;starsmashertools&#39;</span><span class="p">)</span>
    <span class="nd">@clioptions</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Show concatenated simulations&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">show_joined_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cli</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.bintools</span>
        <span class="n">newline</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">bintools</span><span class="o">.</span><span class="n">Style</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;characters&#39;</span><span class="p">,</span> <span class="s1">&#39;newline&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;joined simulations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;There are no joined simulations&quot;</span>
        <span class="k">return</span> <span class="n">newline</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archive</span><span class="p">[</span><span class="s1">&#39;joined simulations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Return a new :class:`~.State` object and call :meth:`~.State.get`\.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">state</span></div>



<span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Contains information about a :class:`~.Simulation` which can be used to</span>
<span class="sd">    check for changes in a :class:`~.Simulation` over time. A :class:`~.State`</span>
<span class="sd">    cares only about changes which StarSmasher has made to the physical </span>
<span class="sd">    simulation and all other changes are ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span> <span class="p">:</span> <span class="n">Simulation</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">starsmashertools</span>
        <span class="kn">import</span> <span class="nn">starsmashertools.helpers.path</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">simulation</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">get_simulation</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Get the modification times of all the files that we expect for</span>
        <span class="c1"># StarSmasher to produce. This will set this unique state.</span>
        <span class="n">patterns_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                    <span class="n">f</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;mtimes&#39;</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">State</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Uninitialized State object. You must call the get() function before using a State object.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">State</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__json_view__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">max_mtime</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">mtime</span> <span class="k">for</span> <span class="n">mtime</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">max_mtime</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;simulation&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="p">,</span>
            <span class="s1">&#39;mtimes&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span><span class="p">,</span>
        <span class="p">}</span>
    
    <span class="nd">@staticmethod</span>
    <span class="nd">@starsmashertools</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">argumentenforcer</span><span class="o">.</span><span class="n">enforcetypes</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="n">obj</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">])</span>
        <span class="n">state</span><span class="o">.</span><span class="n">mtimes</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;mtimes&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">state</span>
    
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">State</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">State</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">simulation</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;State objects from two different simulations cannot be compared: </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">simulation</span><span class="p">))</span>

        <span class="n">keys1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">keys2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">mtimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">keys1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keys2</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">mtimes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
        
    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># A State is &#39;greater than&#39; another if it contains new or more recent</span>
        <span class="c1"># files than the other state. If the other state contains any new or</span>
        <span class="c1"># more recent files, this returns False.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">State</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">mtimes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># If other contains files that we don&#39;t have, we are not greater</span>
            <span class="c1"># than it</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># If other has at least one more recent file than us, we aren&#39;t</span>
            <span class="c1"># greater than it</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtimes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span> <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># If we are not equal to other, then we must be greater than it</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">State</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">other</span>
    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span>
    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Roger Hatfull.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>